<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Categories | Mcland Pharma</title>
    <link rel="stylesheet" href="./assets/css/navbar_footer.css" />
    <link rel="stylesheet" href="./assets/css/categories.css" />
  </head>
  <body>
    <header class="navbar">
      <div class="navbar-top">
        <div
          class="logo"
          onclick="this.querySelector('a').click(); return true;"
        >
          <img src="./assets/image2/logo.png" alt="MCland Pharma Logo" />
          <a href="./index.html"></a>
        </div>
        <!-- <div class="delivery">
            <span>Deliver to <strong>110002</strong></span>
          </div> -->
        <div class="navbar-top-right">
          <!-- <div class="search-bar">
              <input type="text" placeholder="Search for medicine...">
            </div> -->
          <div class="actions">
            <!-- <button>Upload</button> -->

            <button type="button">
              <a class="a Cart" href="./cart.html"
                ><img
                  src="https://cdn-icons-png.flaticon.com/512/3144/3144456.png"
                  alt="Cart"
                  class="cart-icon"
              /></a>
            </button>
            <button type="button">
              <a class="a signin_signup" href="#">Sign in / Sign up</a>
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Filter and Search Section -->
    <div class="filter-search">
      <div class="search-bar">
        <input
          type="text"
          id="searchInput"
          placeholder="Search for medicines..."
        />
        <button onclick="searchMedicines()">Search</button>
      </div>
      <div class="filter-options">
        <label for="categories">Filter by Category:</label>
        <select id="categories" onchange="filterCategory()">
          <option value="all">All Categories</option>
          <option value="1">USA Premium</option>
          <option value="2">Cardiac Care</option>
          <option value="3">General Health Care</option>
          <option value="4">Men's Health</option>
          <option value="5">Mental Health</option>
          <option value="6">Pain Medication</option>
          <option value="7">Sexual Wellness</option>
          <option value="8">Skincare</option>
          <option value="9">Steroids</option>
          <option value="10">Women's Health</option>
        </select>
      </div>
    </div>

    <section id="product-grid">  
    <!-- <script>
        async function loadSheetData() {
          
          const sheetID = "1XVbrA6eUv85eOoJO6mziJ35LI8x2copV_ka7qil2ycU"; // Replace with your Sheet ID
          const apiKey = "AIzaSyD7mumdGgofUc1DE_bgaYJtOKK4i421iA8"; // Replace with your Google API Key
          
          const range2 = "Sheet1!Y5:AF"; 
          const range = "Sheet1!A5:V"; // Adjust based on your data range
          const url2 = `https://sheets.googleapis.com/v4/spreadsheets/${sheetID}/values/${range2}?key=${apiKey}`;
          const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetID}/values/${range}?key=${apiKey}`;

          const category = document.getElementById('categories').value;
          console.log("this is the option chosen",category);
          try {
            const response2 = await fetch(url2);
            const data2 = await response2.json();

            const response = await fetch(url);
            const data = await response.json();

            if (!data.values || !data2.values) {
              throw new Error("No data found in the specified range.");
            }

            const rows = data.values;
            const row2 = data2.values;

            const tableBody = document.getElementById("product-grid");
            tableBody.innerHTML = ""; // Clear table

            rows.forEach((row) => {
              const productID = row[0]; 
              let price=0;
              let p=0;
              row2.forEach((row2)=>{
                if(row2[1] == row[0] && p == 0){
                  price = row2[6];
                  p=p+1;
                }
              });

              
              
              const rowHTML = `
              <div class="product-card medicine-card ${row[1] || "all"}">
              <img src="${row[15] || ""}" alt="Product 1" />
              <div class="product-details">
              <h3>${row[2] || ""}</h3>
              <p class="price">${price}</p>
              <div class="product-buttons">
              <button class="buy-btn"><a href="./product_overview.html?product_ID=${productID}">Buy</a></button>
              <button class="cart-btn">Add to Cart</button>
              </div>
             </div>
             </div>
        `
        ;

              tableBody.innerHTML += rowHTML;
            });
          } catch (error) {
            console.error("Error fetching data:", error);
          }
        }

        loadSheetData();
      </script> -->
      <script>
        async function loadSheetData() {
  const sheetID = "1XVbrA6eUv85eOoJO6mziJ35LI8x2copV_ka7qil2ycU";
  const apiKey = "AIzaSyD7mumdGgofUc1DE_bgaYJtOKK4i421iA8";
  
  const category = document.getElementById('categories').value;
  console.log("Category selected:", category);
  
  try {
    // Show loading indicator
    const tableBody = document.getElementById("product-grid");
    tableBody.innerHTML = "<div class='loading'>Loading products...</div>";
    
    // Fetch both datasets in parallel
    const [priceData, productData] = await Promise.all([
      fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetID}/values/Sheet1!Y5:AF?key=${apiKey}`)
        .then(response => response.json()),
      fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetID}/values/Sheet1!A5:V?key=${apiKey}`)
        .then(response => response.json())
    ]);
    
    if (!productData.values || !priceData.values) {
      throw new Error("No data found in the specified range.");
    }
    
    // Process all price data first and store in a map for O(1) lookups
    const priceMap = new Map();
    priceData.values.forEach(row => {
      if (row[1]) { // Product ID is at index 1
        priceMap.set(row[1], row[6]); // Price is at index 6
      }
    });
    
    // Filter by category if needed
    let filteredProducts = productData.values;
    if (category !== 'all') {
      filteredProducts = productData.values.filter(row => row[1] === category);
    }
    
    // Create document fragment for better performance
    const fragment = document.createDocumentFragment();
    
    // Build HTML with batch processing
    const batchSize = 20;
    tableBody.innerHTML = ""; // Clear the loading indicator
    
    for (let i = 0; i < filteredProducts.length; i += batchSize) {
      // Process in batches to prevent UI freezing
      setTimeout(() => {
        const batch = filteredProducts.slice(i, i + batchSize);
        
        batch.forEach(row => {
          const productID = row[0];
          const price = priceMap.get(productID) || "Price not available";
          
          const productCard = document.createElement('div');
          productCard.className = `product-card medicine-card ${row[1] || "all"}`;
          
          productCard.innerHTML = `
          
            <img src="${row[15] || ""}" alt="Product" loading="lazy" />
            <div class="product-details">
              <h3>${row[2] || ""}</h3>
              <p class="price">${price}</p>
              <div class="product-buttons">
                <button class="buy-btn"><a href="./product_overview.html?product_ID=${productID}">Buy</a></button>
                <button class="cart-btn">Add to Cart</button>
              </div>
            </div>
          `;
          
          fragment.appendChild(productCard);
        });
        
        tableBody.appendChild(fragment.cloneNode(true));
      }, 0);
    }
  } catch (error) {
    console.error("Error fetching data:", error);
    document.getElementById("product-grid").innerHTML = 
      "<div class='error'>Error loading products. Please try again later.</div>";
  }
}

// Search function
function searchMedicines() {
  const searchTerm = document.getElementById('searchInput').value.toLowerCase();
  const productCards = document.querySelectorAll('.product-card');
  
  productCards.forEach(card => {
    const productName = card.querySelector('h3').textContent.toLowerCase();
    if (productName.includes(searchTerm)) {
      card.style.display = 'block';
    } else {
      card.style.display = 'none';
    }
  });
}

// Filter function
function filterCategory() {
  loadSheetData();
}

// Add event listener for search input
document.getElementById('searchInput').addEventListener('input', searchMedicines);

// Initialize data loading
document.addEventListener('DOMContentLoaded', loadSheetData);
      </script>
      


      <!-- Add more product cards as needed -->
    </section>

    <footer class="footer">
      <div class="footer-content">
        <div class="footer-section resources">
          <h3>Resources</h3>
          <ul>
            <li><a href="#">Shipping</a></li>
            <li><a href="#">Returns & Refunds</a></li>
            <li><a href="#">Payment Methods</a></li>
            <li><a href="#">FAQs</a></li>
          </ul>
        </div>
        <div class="footer-section legal">
          <h3>Legal</h3>
          <ul>
            <li><a href="#">About Us</a></li>
            <li><a href="#">Contact Us</a></li>
            <li><a href="#">Terms & Conditions</a></li>
            <li><a href="#">Privacy Policy</a></li>
            <li><a href="#">Cancellation Policy</a></li>
          </ul>
        </div>
        <div class="footer-section support">
          <h3>Support 24/7</h3>
          <p><i class="fa fa-envelope"></i> support@mclandpharma.com</p>
          <p><i class="fa fa-phone"></i> +1 315 666 5976</p>
        </div>
        <div class="footer-section disclaimer">
          <h3>Disclaimer</h3>
          <p>
            The services on Mcland Pharma are available for millions of people
            solely presented for informative, qualitative, quantitative, and
            affordable medicinal purposes. Here we believe The Doctor’s advice =
            The Best Advice for medicinal needs by following protocol
            accordingly by people suffering from different conditions.
          </p>
        </div>
      </div>
      <div class="footer-bottom">
        <div class="footer-left">
          <p class="copyright">
            &copy; 2024 Mcland Pharma. All rights reserved.
          </p>
          <p>© 2024 All rights reserved. Mcland Pharma</p>
          <p>
            Mcland Pharma has been working on a change towards healthcare and
            improving health. We are on a mission Encouraging Healthcare –
            Improving Health since 2013. We have covered the finest medicines
            for the mission towards cure with a few simple steps at
            budget-friendly prices.
          </p>
        </div>
        <div class="footer-right">
          <h3>Payment modes</h3>
          <div class="payment-icons">
            <img src="./assets/image/cash_app.png" alt="Cash App" />
            <img src="./assets/image/zelle.png" alt="Zelle" />
            <img src="./assets/image/venmo.png" alt="Venmo" />
            <!-- <img src="./assets/image/apple_pay.png" alt="Apple Pay">
              <img src="./assets/image/Gpay.png" alt="Google Pay"> -->
            <img src="./assets/image/pay_pal.jpg" alt="Paypal" />
            <!-- <img src="./assets/image/wire_transfer.png" alt="Wire Transfer"> -->
            <img src="./assets/image/bitcoin.png" alt="Bitcoin" />
          </div>
        </div>
      </div>
    </footer>

    <script>
      document.querySelectorAll(".navbar-bottom li").forEach((item) => {
        item.addEventListener("click", function (e) {
          const dropdown = this.querySelector(".dropdown");
          if (dropdown) {
            e.stopPropagation(); // Prevents clicks from propagating to other elements
            dropdown.style.display =
              dropdown.style.display === "block" ? "none" : "block";
          }
        });

        item.addEventListener("mouseover", function () {
          const dropdown = this.querySelector(".dropdown");
          if (dropdown) {
            dropdown.style.display = "block";
          }
        });

        item.addEventListener("mouseout", function () {
          const dropdown = this.querySelector(".dropdown");
          if (dropdown) {
            dropdown.style.display = "none";
          }
        });
      });

      // Close dropdowns when clicking outside
      document.addEventListener("click", () => {
        document.querySelectorAll(".dropdown").forEach((dropdown) => {
          dropdown.style.display = "none";
        });
      });
    </script>
    <script src="./assets/js/categories.js"></script>
  </body>
</html>
