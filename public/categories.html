<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Categories | Mcland Pharma</title>
    <link rel="stylesheet" href="./assets/css/navbar_footer.css" />
    <link rel="stylesheet" href="./assets/css/categories.css" />
  </head>
  <body>
    <header class="navbar">
      <div class="navbar-top">
        <div
          class="logo"
          onclick="this.querySelector('a').click(); return true;"
        >
          <img src="./assets/image2/logo.png" alt="MCland Pharma Logo" />
          <a href="./index.html"></a>
        </div>
        <div class="navbar-top-right">
          <div class="actions">
            <button type="button">
              <a class="a Cart" href="./cart.html">
                <img
                  src="https://cdn-icons-png.flaticon.com/512/3144/3144456.png"
                  alt="Cart"
                  class="cart-icon"
                />
              </a>
            </button>
            <button type="button">
              <a class="a signin_signup" href="#">Sign in / Sign up</a>
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Filter and Search Section -->
    <div class="filter-search">
      <div class="search-bar">
        <input
          type="text"
          id="searchInput"
          placeholder="Search for medicines..."
        />
        <button onclick="searchMedicines()">Search</button>
      </div>
      <div class="filter-options">
        <label for="categories">Filter by Category:</label>
        <select id="categories" onchange="filterCategory()">
          <option value="all">All Categories</option>
          <option value="1">USA Premium</option>
          <option value="2">General Health Care</option>
          <option value="3">Pain Medication</option>
          <option value="4">Cardiac Care</option>
          <option value="5">Mental Health</option>
          <option value="6">Sexual Wellness</option>
          <option value="7">Skincare</option>
          <option value="8">Steroids</option>
          <option value="9">Women's Health</option>
          <option value="10">Men's Health</option>
        </select>
      </div>
    </div>

    <section id="product-grid">
      <script>
        document.addEventListener("DOMContentLoaded", () => {
          // Fetch data based on category from the PostgreSQL database
          async function loadProductData(categoryID) {
            const loadingMessage = document.getElementById("loading-message");
            if (loadingMessage) {
              loadingMessage.innerText = "LOADING PRODUCTS...";
            }

            const tableBody = document.getElementById("product-grid");
            try {
              const response = await fetch(
                `/products?categoryID=${categoryID}`
              );
              const products = await response.json();

              const pricesResponse = await fetch("/product-prices");
              const prices = await pricesResponse.json();

              if (products.length === 0) {
                tableBody.innerHTML = `<p>No products found for the selected category.</p>`;
                if (loadingMessage) {
                  loadingMessage.style.display = "none";
                }
                return;
              }

              tableBody.innerHTML = ""; // Clear the previous data
              displayBatch(products, prices, 0, products.length, tableBody);
              if (loadingMessage) {
                loadingMessage.style.display = "none";
              }
            } catch (error) {
              console.error("Error loading product data:", error);
              if (loadingMessage) {
                loadingMessage.innerText =
                  "Error loading products. Please try again.";
              }
            }
          }

          // Display a batch of rows
          function displayBatch(products, prices, start, end, tableBody) {
            const batch = products.slice(start, end);

            batch.forEach((product) => {
              const productID = product.id;
              const priceObj = prices.find(
                (price) => price.product_id === productID
              );
              const price = priceObj ? price.price : "Price not available";

              const rowHTML = `
        <div class="product-card medicine-card ${
          product.category_id || "all"
        }" data-product-id="${productID}">
          <img src="${
            product.primary_img || ""
          }" alt="Product Image" loading="lazy"
  onload="this.style.opacity='1'" />
          <div class="product-details">
            <h3>${product.product_name || "No Description"}</h3>
            <p id="pric">(${product.trade_names})</p>
            <div class="product-buttons">
              <button class="buy-btn">
                <a href="./product_overview.html?product_ID=${
                  product.product_id
                }">Buy</a>
              </button>
            </div>
          </div>
        </div>
      `;
              tableBody.innerHTML += rowHTML;
            });
          }

          // Function to handle category filtering
          // Function to handle category filtering
          function filterCategory() {
            const selectedCategory =
              document.getElementById("categories").value;
            loadProductData(selectedCategory);
          }

          // Load data on initial page load
          const urlParams = new URLSearchParams(window.location.search);
          const initialCategoryID = urlParams.get("catogeries_ID") || "all";
          document.getElementById("categories").value = initialCategoryID;
          loadProductData(initialCategoryID);
        });
      </script>
      <script>
        // Fetch data based on category from URL

        // Display a batch of rows

        // Function to handle category filtering
      </script>

      <div id="loading-message" class="loading-message">LOADING...</div>
    </section>

    <!-- <script>
      // Define the addToCart function to send data to the backend
      async function addToCart(productId , quantity) {
     
        try {
          const response = await fetch("/add-to-cart", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ productId, quantity }),
          });
          const result = await response.json();
          if (result.success) {
            alert("Product added to cart!");
          } else {
            alert("Error: " + result.message);
          }
        } catch (error) {
          console.error("Error:", error);
          alert("Server error, please try again later.");
        }
      }
    
      // Use event delegation so that dynamically loaded buttons work
      document.getElementById("product-grid").addEventListener("click", (e) => {
        // Check if the clicked element is the "Add to Cart" button or within it
        if (
          e.target.classList.contains("cart-btn") ||
          e.target.closest(".cart-btn")
        ) {
          e.preventDefault();
          const productCard = e.target.closest(".product-card");
          const productId = productCard ? productCard.getAttribute("data-product-id") : null;
          let quan = document.getElementById('pric').textContent;
          const quantity = quan.replace(/[&\/\\#,+()$~%.'":*?<>{}]/g, '');
          console.log("Quantity is ",quantity);
          if (productId) {
            addToCart(productId , quantity);
          } else {
            console.error("No product ID found");
          }
        }
      });
    </script> -->

    <footer class="footer">
      <div class="footer-content">
        <div class="footer-section resources">
          <h3>Resources</h3>
          <ul>
            <li><a href="#">Shipping</a></li>
            <li><a href="#">Returns & Refunds</a></li>
            <li><a href="#">Payment Methods</a></li>
            <li><a href="#">FAQs</a></li>
          </ul>
        </div>
        <div class="footer-section legal">
          <h3>Legal</h3>
          <ul>
            <li><a href="#">About Us</a></li>
            <li><a href="#">Contact Us</a></li>
            <li><a href="#">Terms & Conditions</a></li>
            <li><a href="#">Privacy Policy</a></li>
            <li><a href="#">Cancellation Policy</a></li>
          </ul>
        </div>
        <div class="footer-section support">
          <h3>Support 24/7</h3>
          <p><i class="fa fa-envelope"></i> support@mclandpharma.com</p>
          <p><i class="fa fa-phone"></i> +1 315 666 5976</p>
        </div>
        <div class="footer-section disclaimer">
          <h3>Disclaimer</h3>
          <p>
            The services on Mcland Pharma are available for millions of people
            solely presented for informative, qualitative, quantitative, and
            affordable medicinal purposes. Here we believe The Doctor’s advice =
            The Best Advice for medicinal needs by following protocol
            accordingly by people suffering from different conditions.
          </p>
        </div>
      </div>
      <div class="footer-bottom">
        <div class="footer-left">
          <p class="copyright">
            &copy; 2024 Mcland Pharma. All rights reserved.
          </p>
          <p>© 2024 All rights reserved. Mcland Pharma</p>
          <p>
            Mcland Pharma has been working on a change towards healthcare and
            improving health. We are on a mission Encouraging Healthcare –
            Improving Health since 2013.
          </p>
        </div>
        <div class="footer-right">
          <h3>Payment modes</h3>
          <div class="payment-icons">
            <img src="./assets/image/cash_app.png" alt="Cash App" />
            <img src="./assets/image/zelle.png" alt="Zelle" />
            <img src="./assets/image/venmo.png" alt="Venmo" />
            <img src="./assets/image/pay_pal.jpg" alt="Paypal" />
            <img src="./assets/image/bitcoin.png" alt="Bitcoin" />
          </div>
        </div>
      </div>
    </footer>

    <!-- If you have any external script files, adjust the path accordingly -->
    <script src="./assets/js/categories.js"></script>
  </body>
</html>
