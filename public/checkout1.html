<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checkout | Mcland Pharma</title>
    <link rel="stylesheet" href="./assets/css/navbar_footer.css" />
    <link rel="stylesheet" href="./assets/css/checkout.css" />
    <style>
      .modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.5);
  justify-content: center;
  align-items: center;
}

.modal-content {
  background: #fff;
  border-radius: 12px;
  padding: 30px;
  width: 400px;
  text-align: center;
  animation: fadeIn 0.3s ease;
}

.modal-content h2 {
  margin-bottom: 10px;
  color: #222;
}

.modal-content p {
  margin: 10px 0;
  color: #555;
}

.modal-content button {
  margin: 10px 5px;
  padding: 10px 15px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}

.modal-content button:first-of-type {
  background-color: #FF6B5E;
  color: #fff;
}

.modal-content button:last-of-type {
  background-color: transparent;
  color: #FF6B5E;
  border: 1px solid #FF6B5E;
}

.modal-img {
  width: 100px;
  margin-bottom: 20px;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}
    </style>
  </head>
  <body>
    <!-- Confirmation Modal -->
<div id="confirmationModal" class="modal">
  <div class="modal-content">
    <img src="https://cdn-icons-png.flaticon.com/512/190/190411.png" alt="Success" class="modal-img" />
    <h2>Thank you for your purchase!</h2>
    <p>Your order number is <strong>#54871648754</strong></p>
    <p>You’ll get an email confirmation for your order details</p>
    <button  id="place-order-btn">View order</button>
    <button onclick="goHome()">Go to home</button>
  </div>
</div>
<script>
  function openConfirmationPopup() {
    document.getElementById("confirmationModal").style.display = "flex";
  }

  function trackOrder() {
    window.location.href = "/track-order"; // Customize this link
  }

  function goHome() {
    window.location.href = "/"; // Go back to homepage
  }

  // Optional: Close on outside click
  window.onclick = function (event) {
    const modal = document.getElementById("confirmationModal");
    if (event.target === modal) {
      modal.style.display = "none";
    }
  }
</script>

    <header class="navbar">
      <div class="navbar-top" id="navbar">
        <div
          class="logo"
          onclick="this.querySelector('a').click(); return true;"
        >
          <img src="./assets/image2/logo.png" alt="MCland Pharma Logo" />
          <a href="./index.html"></a>
        </div>
        <!-- <div class="delivery">
            <span>Deliver to <strong>110002</strong></span>
          </div> -->
        <div class="navbar-top-right">
          <!-- <div class="search-bar">
              <input type="text" placeholder="Search for medicine...">
            </div> -->
          <div class="actions">
            <!-- <button>Upload</button> -->
            <!-- <button type="button"><a class="a offer" href="#">Offers</a></button> -->
            <button type="button">
              <a class="a Cart" href="./cart.html"
                ><img
                  src="https://cdn-icons-png.flaticon.com/512/3144/3144456.png"
                  alt="Cart"
                  class="cart-icon"
              /></a>
            </button>
            <!-- <button type="button"><a class="a signin_signup" href="#">Sign in / Sign up</a></button> -->
          </div>
        </div>
      </div>
    </header>

    <!-- Checkout Form -->
    <main class="checkout-container">
      <h1>Billing Details</h1>
      <!-- <progress id="checkout-form" max="100" value="70">70%</progress> -->
      <div class="checkout-card" class="input-group form-group">
        <form id="checkout-form" class="checkout-form">
          <!-- Billing Details -->
          <div class="form-group input-group">
            <input
              type="text"
              id="first-name"
              name="firstName"
              placeholder=" "
              required
            />
            <label for="first-name">First Name <span>*</span></label>
          </div>
          <div class="form-group input-group">
            <input
              type="text"
              id="last-name"
              name="lastName"
              placeholder=" "
              required
            />
            <label for="last-name">Last Name <span>*</span></label>
          </div>

          <div class="form-group input-group">
            <input
              type="text"
              id="street-address"
              name="billingStreetAddress"
              placeholder=" "
              required
            />
            <label for="street-address">Street Address <span>*</span></label>
          </div>
          <div class="form-group input-group">
            <input
              type="text"
              id="ship-city"
              name="shipCity"
              placeholder=" "
              required
            />
            <label for="ship-city">City <span>*</span></label>
          </div>
          <div class="input-group">
            <select id="state" name="billingState" required>
              <option value="" disabled selected hidden></option>
              <option value="Texas">Texas</option>
              <option value="California">California</option>
              <option value="New York">New York</option>
            </select>
            <label for="state">State <span>*</span></label>
          </div>
          <div class="form-group input-group">
            <input
              type="text"
              id="zip-code"
              name="billingZip"
              placeholder=" "
              required
            />
            <label for="zip-code">ZIP Code <span>*</span></label>
          </div>
          <div class="form-group input-group">
            <select id="country" placeholder=" " required>
              <!-- <option value="United States"> </option> -->
              <option value="United States">United States (US)</option>
              <!-- <option value="India">India</option> -->
              <option value="Canada">Canada</option>
            </select>
            <label for="country">Country / Region <span>*</span></label>
          </div>
          <div class="form-group input-group">
            <input
              type="tel"
              id="phone"
              name="phone"
              placeholder=" "
              required
            />
            <label for="phone">Phone <span>*</span></label>
          </div>

          <div class="form-group input-group">
            <input
              type="email"
              id="email"
              name="email"
              placeholder=" "
              required
            />
            <label for="email">Email Address <span>*</span></label>
          </div>

          <!-- Shipping Address Checkbox -->
          <div class="form-group-shipping">
            <input type="checkbox" id="different-address" />
            <label for="different-address">Ship to a different address?</label>
          </div>
          <!-- Additional Address Form -->
          <div id="shipping-address-form" style="display: none">
            <h2>Shipping Address</h2>
            <div class="form-group">
              <label for="ship-street-address"> <span>*</span></label>
              <input
                type="text"
                id="ship-street-address"
                name="shipStreetAddress"
              />
            </div>
            <div>
              <div class="form-group">
                <label for="ship-city"> <span>*</span></label>
                <input type="text" id="ship-city" name="shipCity" />
              </div>
            </div>
            <div class="form-group">
              <label for="ship-zip">ZIP Code <span>*</span></label>
              <input type="text" id="ship-zip" name="shipZip" />
            </div>
          </div>
        </form>

        <!-- Order Summary -->
        <section class="order-summary">
          <h2>Your Order</h2>
          <table>
            <thead>
              <tr>
                <th>Product</th>
                <th>Subtotal</th>
              </tr>
            </thead>
            <tbody id="cart-items">
              <!-- Cart items will be dynamically injected here -->
            </tbody>
            <tfoot>
              <tr>
                <td>Shipping</td>
                <td id="shipping-cost">$50.00</td>
              </tr>
              <tr>
                <td>Total</td>
                <td id="total-cost">$0.00</td>
              </tr>
            </tfoot>
          </table>
          <!-- Place Order Button -->
          <button id="place-order-btn" onclick="openConfirmationPopup()" class="place-order-btn">
            Place Order
          </button>
        </section>
      </div>
    </main>

    <footer class="footer">
      <div class="footer-content">
        <div class="footer-section resources">
          <h3>Resources</h3>
          <ul>
            <li><a href="#">Shipping</a></li>
            <li><a href="#">Returns & Refunds</a></li>
            <li><a href="#">Payment Methods</a></li>
            <li><a href="#">FAQs</a></li>
          </ul>
        </div>
        <div class="footer-section legal">
          <h3>Legal</h3>
          <ul>
            <li><a href="#">About Us</a></li>
            <li><a href="#">Contact Us</a></li>
            <li><a href="#">Terms & Conditions</a></li>
            <li><a href="#">Privacy Policy</a></li>
            <li><a href="#">Cancellation Policy</a></li>
          </ul>
        </div>
        <div class="footer-section support">
          <h3>Support 24/7</h3>
          <p><i class="fa fa-envelope"></i> support@mclandpharma.com</p>
          <p><i class="fa fa-phone"></i> +1 315 666 5976</p>
        </div>
        <div class="footer-section disclaimer">
          <h3>Disclaimer</h3>
          <p>
            The services on Mcland Pharma are available for millions of people
            solely presented for informative, qualitative, quantitative, and
            affordable medicinal purposes. Here we believe The Doctor’s advice =
            The Best Advice for medicinal needs by following protocol
            accordingly by people suffering from different conditions.
          </p>
        </div>
      </div>
      <div class="footer-bottom">
        <div class="footer-left">
          <p class="copyright">
            &copy; 2024 Mcland Pharma. All rights reserved.
          </p>
          <p>© 2024 All rights reserved. Mcland Pharma</p>
          <p>
            Mcland Pharma has been working on a change towards healthcare and
            improving health. We are on a mission Encouraging Healthcare –
            Improving Health since 2013. We have covered the finest medicines
            for the mission towards cure with a few simple steps at
            budget-friendly prices.
          </p>
        </div>
        <div class="footer-right">
          <h3>Payment modes</h3>
          <div class="payment-icons">
            <img src="./assets/image/cash_app.png" alt="Cash App" />
            <img src="./assets/image/zelle.png" alt="Zelle" />
            <img src="./assets/image/venmo.png" alt="Venmo" />
            <!-- <img src="./assets/image/apple_pay.png" alt="Apple Pay">
          <img src="./assets/image/Gpay.png" alt="Google Pay"> -->
            <img src="./assets/image/pay_pal.jpg" alt="Paypal" />
            <!-- <img src="./assets/image/wire_transfer.png" alt="Wire Transfer"> -->
            <img src="./assets/image/bitcoin.png" alt="Bitcoin" />
          </div>
        </div>
      </div>
    </footer>

    <script>
      document.querySelectorAll(".navbar-bottom li").forEach((item) => {
        item.addEventListener("click", function (e) {
          const dropdown = this.querySelector(".dropdown");
          if (dropdown) {
            e.stopPropagation(); // Prevents clicks from propagating to other elements
            dropdown.style.display =
              dropdown.style.display === "block" ? "none" : "block";
          }
        });

        item.addEventListener("mouseover", function () {
          const dropdown = this.querySelector(".dropdown");
          if (dropdown) {
            dropdown.style.display = "block";
          }
        });

        item.addEventListener("mouseout", function () {
          const dropdown = this.querySelector(".dropdown");
          if (dropdown) {
            dropdown.style.display = "none";
          }
        });
      });

      // Close dropdowns when clicking outside
      document.addEventListener("click", () => {
        document.querySelectorAll(".dropdown").forEach((dropdown) => {
          dropdown.style.display = "none";
        });
      });

      document.addEventListener("DOMContentLoaded", async () => {
        const cartItemsElement = document.getElementById("cart-items");
        const totalCostElement = document.getElementById("total-cost");
        const shippingCost = 50.0; // Flat shipping cost

        try {
          const response = await fetch("/api/cart");
          const result = await response.json();

          if (result.success) {
            const cartItems = result.data;
            let total = 0;

            // Clear the cart items element
            cartItemsElement.innerHTML = "";

            // Populate the cart items
            cartItems.forEach((item) => {
              console.log(parseFloat(item.price));
              const subtotal = parseFloat(item.price);
              total += subtotal;

              const row = `
          <tr>
            <td>${item.name} ${item.mg || ""}mg x ${item.quantity}</td>
            <td>$${item.price}</td>
          </tr>
        `;
              cartItemsElement.innerHTML += row;
            });

            // Update the total cost
            totalCostElement.textContent = `$${(total + shippingCost).toFixed(
              2
            )}`;
          } else {
            console.error("Failed to fetch cart items:", result.message);
          }
        } catch (error) {
          console.error("Error fetching cart items:", error);
        }
      });

      // checkout1.js
      document
        .getElementById("place-order-btn")
        .addEventListener("click", async () => {
          try {
            // Collect billing details with null checks
            const getValue = (id) => {
              const element = document.getElementById(id);
              if (!element) {
                console.error(`Element with ID "${id}" not found.`);
                throw new Error(`Missing required field: ${id}`);
              }
              return element.value;
            };

            const orderData = {
              firstName: getValue("first-name"),
              lastName: getValue("last-name"),
              country: getValue("country"),
              phone: getValue("phone"),
              email: getValue("email"),
              billingCity: getValue("ship-city"),
              companyName: document.getElementById("company-name")?.value || "",
              billingStreetAddress: getValue("street-address"),
              billingState: getValue("state"),
              billingZip: getValue("zip-code"),
            };

            console.log("order data",orderData);
            // Fetch cart items
            const cartRes = await fetch("/api/cart");
            const cartJson = await cartRes.json();
            if (!cartJson.success) {
              alert("Could not fetch cart items");
              return;
            }

            const cartItems = cartJson.data.map((item) => ({
              product_id: item.product_id,
              name: item.name,
              mg: item.mg,
              quantity: parseInt(item.quantity, 10),
              price: parseFloat(item.price),
            }));

            // Compute totals

            const shippingCost = 50.0;
            const subtotal = cartItems.reduce((sum, it) => sum + it.price, 0);
            const totalCost = subtotal + shippingCost;

            // Send everything to /api/checkout
            const res = await fetch("/api/checkout", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                ...orderData,
                cartItems,
                shippingCost,
                totalCost,
              }),
            });
            const result = await res.json();
            if (result.success) {
              //yaha per notification code
              // alert("Order placed! ID: " + result.orderId);
              window.location.href = `/invoice1.html?orderId=${result.orderId}`;
            } else {
              alert("Error placing order");
            }
          } catch (error) {
            console.error("Error placing order:", error);
            alert(`Error: ${error.message}`);
          }
        });
    </script>
    <script>
      // checkout.js
      document
        .getElementById("different-address")
        .addEventListener("change", function () {
          const shippingForm = document.getElementById("shipping-address-form");
          shippingForm.style.display = this.checked ? "block" : "none";
        });

      // Sample dummy cart data
      const sampleCartItems = [
        { product: "Paracetamol 500mg", subtotal: 100 },
        { product: "Cough Syrup", subtotal: 150 },
      ];

      function populateCart(cartItems) {
        const cartBody = document.getElementById("cart-items");
        const totalCostEl = document.getElementById("total-cost");

        let total = 0;
        cartItems.forEach((item) => {
          const row = document.createElement("tr");
          row.innerHTML = `
      <td>${item.product}</td>
      <td>$${item.subtotal.toFixed(2)}</td>
    `;
          cartBody.appendChild(row);
          total += item.subtotal;
        });

        // Add shipping cost
        const shipping = 50;
        total += shipping;

        totalCostEl.textContent = `$${total.toFixed(2)}`;
      }

      window.addEventListener("DOMContentLoaded", () => {
        populateCart(sampleCartItems);
      });
    </script>

    <script src="./assets/js/checkout1.js"></script>

    <!-- Place this at the end, just before </body> -->
    <script>
      let lastScrollY = window.scrollY;
      const navbar = document.getElementById("navbar");

      window.addEventListener("scroll", () => {
        if (window.scrollY > lastScrollY && window.scrollY > 50) {
          navbar.classList.add("hidden");
        } else {
          navbar.classList.remove("hidden");
        }
        lastScrollY = window.scrollY;
      });
    </script>
  </body>
</html>
